<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Building Rico</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_building_rico">1. Building Rico</a>
<ul class="sectlevel2">
<li><a href="#_travis_setup">1.1. Travis setup</a></li>
</ul>
</li>
<li><a href="#_snapshot_releases">2. Snapshot releases</a></li>
<li><a href="#_project_structure">3. Project structure</a>
<ul class="sectlevel2">
<li><a href="#_gradle_build">3.1. Gradle build</a></li>
<li><a href="#_package_structure">3.2. Package structure</a></li>
<li><a href="#_java_module_definition">3.3. Java Module definition</a></li>
<li><a href="#_project_graph">3.4. Project Graph</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_building_rico"><a class="anchor" href="#_building_rico"></a>1. Building Rico</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The build of Rico is based on Gradle.
The Gradle plugins we use for the build currently rely on Gradle version <code>6.4-rc-1</code> or higher.
Since the gradle wrapper is used, you do not need to install Gradle on your system.
Because of a bug in the <code>javadoc</code> executable of early versions of Java 11 you need Java version <code>11.0.6</code> as a minimum version to build rico.
By using older Java 11 releases the build step of the JavaDoc creation will fail.
For executing the integration tests of Rico <code>docker-compose</code> (and <code>docker</code>) is needed.</p>
</div>
<div class="paragraph">
<p>A complete build can be started by</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./gradlew build</pre>
</div>
</div>
<div class="paragraph">
<p>This will build all modules, create the documentation and will execute the integration tests.</p>
</div>
<div class="sect2">
<h3 id="_travis_setup"><a class="anchor" href="#_travis_setup"></a>1.1. Travis setup</h3>
<div class="paragraph">
<p>Rico is automatically build by <a href="https://travis-ci.org">Travis</a>.
The configuration for Travis can be found in the <code>.travis.yml</code> YAML file in the root of the repository.
A new travis build will be triggert by each commit to a pull request or the master branch.
All builds can be found <a href="https://travis-ci.org/github/rico-projects/rico">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_snapshot_releases"><a class="anchor" href="#_snapshot_releases"></a>2. Snapshot releases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each commit to the master branch will automatically trigger a Travis build.
This build will upload the build artifacts as snapshots to <a href="https://oss.jfrog.org">the open snapshot repository from JFrog</a>.
You can find all Rico artifacts <a href="https://oss.jfrog.org/oss-snapshot-local/dev/rico/">here</a>.</p>
</div>
<div class="paragraph">
<p>If you want to depend on snapshot builds of Rico you need to add the maven repository to your build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;distributionManagement&gt;</span>
    <span class="tag">&lt;snapshotRepository&gt;</span>
        <span class="tag">&lt;id&gt;</span>snapshots<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;name&gt;</span>oss-jfrog-artifactory-snapshots<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;url&gt;</span>https://oss.jfrog.org/artifactory/oss-snapshot-local<span class="tag">&lt;/url&gt;</span>
    <span class="tag">&lt;/snapshotRepository&gt;</span>
<span class="tag">&lt;/distributionManagement&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_structure"><a class="anchor" href="#_project_structure"></a>3. Project structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rico is structured in several modules. All these modules are defined as gradle subprojects,
which will create a jar per module. Next to this each module is defined
as a Java module.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rico contains in the incubation folder several modules that are in incubation state.
Furthermore Rico contains several modules only needed for internal unit and integration tests
(see folder integration-tests). All these modules may not follow all the rules and
structure defined here.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_gradle_build"><a class="anchor" href="#_gradle_build"></a>3.1. Gradle build</h3>
<div class="paragraph">
<p>In the root folder of the project you can find the <code>build.gradle</code> file that defines
the build for the rico project and all subprojects. Instead of externalizing build
tasks in the subprojects we decided to define the build steps for different subprojects
types (java module or documentation) in this central file.</p>
</div>
<div class="sect3">
<h4 id="_gradle_subprojects"><a class="anchor" href="#_gradle_subprojects"></a>3.1.1. Gradle subprojects</h4>
<div class="paragraph">
<p>All gradle subprojects are defined in the <code>settings.gradle</code> located in the root folder of the project.</p>
</div>
<div class="paragraph">
<p>Each subproject provides its own gradle file, which must have the
same name as the gradle module (based on the entry in <code>settings.gradle</code>).
The gradle file for the <code>rico-client</code> subproject must be named <code>rico-client.gradle</code>.
Each of these gradle files defines the dependencies of the subproject.
Normally they do not contain any additional information next to the dependencies,
since the general build is defined in the global <code>build.gradle</code> file found in the root folder.</p>
</div>
<div class="paragraph">
<p>Gradle subprojects in Rico won&#8217;t be released by default. To add a module to releases of Rico
the <code>publishJars</code> gradle property must be set to <code>true</code>. This is done in the
<code>gradle.properties</code> file that is located in all modules that will be included in
a release. The concrete effect of the <code>publishJars</code> property can be found in the <code>build.gradle</code>
file in the project root folder.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_package_structure"><a class="anchor" href="#_package_structure"></a>3.2. Package structure</h3>
<div class="paragraph">
<p>Each subproject has its sources split into internal and public packages.
This split is additionally defined in the Java module config and hides all private APIs.
While the public API defines its own base package, the packages containing the internal API start with <code>dev.rico.internal</code>.
This is done to be compatible with the Java module system.
You can then find a structure like the following one in each module:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dev.rico.internal.MODULE_BASE_PACKAGE &lt;- private API

dev.rico.MODULE_BASE_PACKAGE &lt;- public API</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_module_definition"><a class="anchor" href="#_java_module_definition"></a>3.3. Java Module definition</h3>
<div class="paragraph">
<p>Each subproject must be defined as a Java Module and must contain
a <code>module-info.java</code> file in the <code>scr/main/java</code> folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_project_graph"><a class="anchor" href="#_project_graph"></a>3.4. Project Graph</h3>
<div class="paragraph">
<p>Since one main goal of Rico is to provide client side APIs and features
next to the server side modules a lot of modules of rico are targeted for
the client or the server. In general all modules and its dependencies follow
a common pattern that can be found in the base modules as shown in the following
diagram:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/base-gradle-modules.svg" alt="base gradle modules"></span></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0.0-SNAPSHOT<br>
Last updated 2020-06-29 12:54:34 UTC
</div>
</div>
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</body>
</html>